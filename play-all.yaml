---
- name: Create droplet on Digital Ocean
  hosts: localhost
  connection: local
  vars_files:
    - secrets.yaml
  roles:
  - role: create-droplet
    
- name: Prepare created droplet for running applications
  hosts: droplet
  vars_files:
    - secrets.yaml
  roles:
  - role: prepare-droplet
    docker_login: emlagowski

- name: Run nginx reverse proxy on created droplet
  hosts: droplet
  vars_files:
    - secrets.yaml
  roles:
  - role: initialize-nginx
    git_repo_ssh: git@github.com:emlagowski/nginx-proxy-with-lets-encrypt.git
    certificate_owner_email: marcinlagowski92@gmail.com

- name: Run example-project with public domain
  hosts: droplet
  vars_files:
    - secrets.yaml
  roles:
  - role: run-project
    git_repo_ssh: git@github.com:emlagowski/droplet-example-project.git
    domain: "abc.letsbesanta.com"
  environment:
    DOMAINS: "abc.letsbesanta.com,www.abc.letsbesanta.com"

- name: Run example-project-2 with public domain
  hosts: droplet
  vars_files:
    - secrets.yaml
  roles:
  - role: run-project
    git_repo_ssh: git@github.com:emlagowski/droplet-example-project.git
    domain: "xyz.letsbesanta.com"
  environment:
    DOMAINS: "xyz.letsbesanta.com,www.xyz.letsbesanta.com"

    